<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ maxsulot.title }}</title>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1b33;
      --panel2:#0c1730;
      --text:#e8eefc;
      --muted:#a9b6d6;
      --line:rgba(255,255,255,.10);
      --primary:#4f8cff;
      --good:#22c55e;
      --danger:#ff4d4d;
      --warn:#fbbf24;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(79,140,255,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(255,255,255,.06), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{ color:inherit; text-decoration:none; }
    .wrap{ width:min(1100px, 92vw); margin: 22px auto 40px auto; }

    .top{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; flex-wrap:wrap;
      padding: 12px 14px;
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      backdrop-filter: blur(10px);
    }
    .crumbs{
      color:var(--muted);
      font-size:13px;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-weight:800;
      cursor:pointer;
      transition:.15s ease;
      white-space:nowrap;
    }
    .back-btn{
          padding:8px 14px;
          background:#333;
          color:blue;
          border:none;
          border-radius:8px;
          cursor:pointer;
        }
        .back-btn:hover{background:#444;}

    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .btn--primary{
      border-color: rgba(79,140,255,.35);
      background: rgba(79,140,255,.22);
    }
    .btn--primary:hover{ background: rgba(79,140,255,.30); }
    .btn--danger{
      border-color: rgba(255,77,77,.30);
      background: rgba(255,77,77,.14);
    }
    .btn--danger:hover{ background: rgba(255,77,77,.20); }

    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(12,23,48,.45);
      box-shadow: 0 18px 45px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .img{
      height: 420px;
      background: linear-gradient(135deg, rgba(79,140,255,.22), rgba(255,255,255,.06));
      display:flex; align-items:center; justify-content:center;
      border-bottom:1px solid var(--line);
    }
    @media (max-width: 900px){
      .img{ height: 320px; }
    }
    .img img{ width:100%; height:100%; object-fit:cover; display:block; }

    .info{ padding: 14px; display:grid; gap:10px; }
    h1{ margin:0; font-size:22px; line-height:1.25; }
    .price{
      font-size:22px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .muted{ color:var(--muted); font-size:13px; line-height:1.6; }

    .chips{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 2px; }
    .chip{
      font-size:12px;
      padding: 6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-weight:800;
    }
    .chip--good{ color:#c7f9d5; border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
    .chip--warn{ color:#fff2c7; border-color: rgba(251,191,36,.25); background: rgba(251,191,36,.10); }

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      padding-top: 6px;
    }

    /* Comments */
    .section{
      margin-top:14px;
      padding: 14px;
    }
    .section h2{ margin:0; font-size:16px; }
    .divider{ height:1px; background: var(--line); margin: 12px 0; }

    textarea, input{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(12,23,48,.60);
      color:var(--text);
      outline:none;
    }
    textarea:focus, input:focus{
      border-color: rgba(79,140,255,.55);
      box-shadow: 0 0 0 4px rgba(79,140,255,.15);
    }
    textarea{ min-height: 120px; resize: vertical; }

    .comment{
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px;
      margin-top: 10px;
    }
    .comment__head{
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      color:var(--muted);
      font-size:13px;
    }
    .comment__body{ margin-top: 8px; line-height:1.65; }

    .row{
      display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="crumbs">
        <a href="{% url 'home' %}">üè† Home</a>
        <span>‚Ä∫</span>
        <a href="{% url 'maxsulotlar' %}">Mahsulotlar</a>
        <span>‚Ä∫</span>
        <span>{{ maxsulot.title }}</span>
      </div>

      <div class="row">
        {% if request.user.is_authenticated %}
          <a class="btn" href="{% url 'sevimlilar' %}">‚ù§Ô∏è Sevimlilar</a>
        {% endif %}
        <a class="btn" href="{% url 'maxsulotlar' %}">‚Üê Orqaga</a>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: IMAGE -->
      <div class="card">
        <div class="img">
          {% if maxsulot.image %}
            <img src="{{ maxsulot.image.url }}" alt="{{ maxsulot.title }}">
          {% else %}
            <div class="muted">Rasm yo‚Äòq</div>
          {% endif %}
        </div>
      </div>

      <!-- RIGHT: INFO -->
      <div class="card">
        <div class="info">
          <h1>{{ maxsulot.title }}</h1>

          <div class="chips">
            <span class="chip chip--warn">‚≠ê 4.8</span>
            <span class="chip chip--good">üöö Tez yetkazish</span>
            {% if maxsulot.created_at %}
              <span class="chip">üïí {{ maxsulot.created_at|date:"d M Y" }}</span>
            {% endif %}
          </div>

          <div class="price">{{ maxsulot.price }} so‚Äòm</div>

          {% if maxsulot.desc %}
            <div class="muted">{{ maxsulot.desc }}</div>
          {% else %}
            <div class="muted">Tavsif mavjud emas.</div>
          {% endif %}

          <div class="actions">
            {% if request.user.is_authenticated %}
              <!-- LIKE TOGGLE -->
              <form method="post" action="{% url 'like_toggle' id=maxsulot.id %}">
                {% csrf_token %}
                {% if liked %}
                  <button class="btn btn--danger" type="submit">‚ù§Ô∏è Like olib tashlash</button>
                {% else %}
                  <button class="btn btn--primary" type="submit">ü§ç Like bosish</button>
                {% endif %}
              </form>

              <!-- BUY / CART (sizda savat url name boshqacha bo‚Äòlishi mumkin) -->

                <a class="btn btn--primary" href="{% url 'cart' %}">üõí Savatga</a>
            {% else %}
              <a class="btn btn--primary" href="{% url 'login' %}">Kirish qilib like bosing</a>
            {% endif %}
          </div>
        </div>
          {% if request.user.is_authenticated and request.user != maxsulot.created_by %}

             <h1><button class="back-btn" onclick="history.back()"><a href="{% url 'messages' maxsulot.id maxsulot.created_by.id %}">üí¨ Sotuvchiga yozish</a></button></h1>
          {% endif %}


        <!-- COMMENTS -->
        <div class="section">
          <h2>Kommentlar</h2>
          <div class="divider"></div>

          {% if request.user.is_authenticated %}
            <form method="post" action="{% url 'comment_qoshish' id=maxsulot.id %}">
              {% csrf_token %}

              {% if comment_form %}
                {% for field in comment_form %}
                  <label class="muted">{{ field.label }}</label>
                  {{ field }}
                {% endfor %}
              {% else %}
                <textarea name="text" placeholder="Komment yozing..."></textarea>
              {% endif %}

              <div class="row">
                <button class="btn btn--primary" type="submit">Yuborish</button>
              </div>
            </form>
          {% else %}
            <div class="muted">Komment yozish uchun login qiling.</div>
          {% endif %}

          {% if maxsulot.comments.all %}
            {% for c in maxsulot.comments.all %}
              <div class="comment">
                <div class="comment__head">
                  <div>üë§ <b>{{ c.user.username }}</b></div>
                  {% if c.created_at %}<div>{{ c.created_at|date:"d M Y H:i" }}</div>{% endif %}
                </div>
                <div class="comment__body">
                  {{ c.text|linebreaksbr }}
                </div>

                {% if request.user == c.user or request.user.is_staff %}
                  <div class="row">
                    <a class="btn" href="{% url 'comment_tahrir' id=c.id %}">‚úèÔ∏è Tahrirlash</a>
                    <a class="btn btn--danger" href="{% url 'comment_ochir' id=c.id %}">üóë O‚Äòchirish</a>
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</body>
</html>
