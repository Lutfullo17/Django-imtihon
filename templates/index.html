<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Online Shop</title>

  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f1b33;
      --panel2:#0c1730;
      --text:#e8eefc;
      --muted:#a9b6d6;
      --line:rgba(255,255,255,.10);
      --primary:#4f8cff;
      --good:#22c55e;
      --warn:#fbbf24;
      --danger:#ff4d4d;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(79,140,255,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 20%, rgba(255,255,255,.06), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    a{ color:inherit; text-decoration:none; }
    img{ max-width:100%; display:block; }
    .wrap{ width:min(1200px, 92vw); margin: 0 auto; }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(11,18,32,.65);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar__in{
      padding: 12px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .logo{
      display:flex; align-items:center; gap:10px;
      font-weight:900; letter-spacing:.2px;
    }
    .logo__mark{
      width:34px; height:34px; border-radius:12px;
      background: rgba(79,140,255,.25);
      border:1px solid rgba(79,140,255,.35);
      display:flex; align-items:center; justify-content:center;
      font-weight:900;
    }
    .logo__text{ line-height:1.1; }
    .logo__text small{ display:block; color:var(--muted); font-weight:600; font-size:12px; margin-top:2px; }

    .search{
      flex: 1;
      min-width: 260px;
      display:flex;
      gap:10px;
      align-items:center;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding: 10px;
      border-radius: 16px;
      position: relative;
    }
    .search input{
      flex:1;
      min-width: 160px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(12,23,48,.6);
      color: var(--text);
      outline:none;
    }
    .search input:focus{
      border-color: rgba(79,140,255,.55);
      box-shadow: 0 0 0 4px rgba(79,140,255,.15);
    }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      gap:8px;
      padding: 12px 14px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--text);
      font-weight:800;
      cursor:pointer;
      transition:.15s ease;
      white-space:nowrap;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .btn--primary{
      border-color: rgba(79,140,255,.35);
      background: rgba(79,140,255,.22);
    }
    .btn--primary:hover{ background: rgba(79,140,255,.30); }
    .btn[disabled]{ opacity:.6; cursor:not-allowed; transform:none; }

    .toplinks{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-weight:700;
      font-size:13px;
    }
    .pill b{ color:var(--text); }

    /* Loading bar */
    .loadingbar{
      position:absolute;
      left:10px; right:10px; bottom:6px;
      height:3px;
      border-radius:999px;
      overflow:hidden;
      background: rgba(255,255,255,.06);
      opacity:0;
      pointer-events:none;
      transition:.15s ease;
    }
    .loadingbar::after{
      content:"";
      display:block;
      height:100%;
      width:40%;
      background: rgba(79,140,255,.75);
      border-radius:999px;
      transform: translateX(-110%);
      animation: loadmove 0.9s linear infinite;
    }
    @keyframes loadmove{
      0%{ transform: translateX(-110%); }
      100%{ transform: translateX(260%); }
    }
    .search.is-loading .loadingbar{ opacity:1; }

    /* Categories row */
    .cats{
      padding: 12px 0 14px 0;
      border-top:1px solid var(--line);
    }
    .cats__row{
      display:flex;
      gap:10px;
      overflow:auto;
      padding-bottom:4px;
      scrollbar-width: thin;
    }
    .cat{
      flex: 0 0 auto;
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-weight:800;
      font-size:13px;
      transition:.15s ease;
      cursor:pointer;
      user-select:none;
    }
    .cat:hover{
      color:var(--text);
      background: rgba(255,255,255,.06);
      transform: translateY(-1px);
    }

    /* Slider */
    .slider{
      margin-top: 18px;
      border:1px solid var(--line);
      border-radius: 22px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
      box-shadow: 0 18px 45px rgba(0,0,0,.35);
      position:relative;
    }
    .slides{
      display:flex;
      transition: transform .45s ease;
      will-change: transform;
    }
    .slide{
      min-width:100%;
      padding: 24px;
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 18px;
      align-items:center;
      background:
        radial-gradient(900px 400px at 20% 20%, rgba(79,140,255,.35), transparent 55%),
        radial-gradient(800px 400px at 80% 60%, rgba(255,255,255,.12), transparent 60%),
        rgba(255,255,255,.03);
    }
    .slide:nth-child(2){
      background:
        radial-gradient(900px 400px at 20% 20%, rgba(34,197,94,.28), transparent 55%),
        radial-gradient(800px 400px at 80% 60%, rgba(255,255,255,.12), transparent 60%),
        rgba(255,255,255,.03);
    }
    .slide:nth-child(3){
      background:
        radial-gradient(900px 400px at 20% 20%, rgba(251,191,36,.22), transparent 55%),
        radial-gradient(800px 400px at 80% 60%, rgba(255,255,255,.12), transparent 60%),
        rgba(255,255,255,.03);
    }
    @media (max-width: 860px){
      .slide{ grid-template-columns: 1fr; }
    }
    .slide h1{ margin:0; font-size:26px; letter-spacing:.2px; }
    .slide p{ margin:10px 0 0 0; color:var(--muted); line-height:1.6; max-width: 60ch; }
    .cta{ margin-top: 14px; display:flex; gap:10px; flex-wrap:wrap; }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-weight:800;
      font-size:12px;
    }
    .box{
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(12,23,48,.45);
      padding: 14px;
      display:grid;
      gap:10px;
    }
    .box .row{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border:1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      background: rgba(255,255,255,.03);
      color:var(--muted);
      font-size:13px;
      font-weight:700;
    }
    .box .row b{ color:var(--text); }

    .slider__btn{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width:42px; height:42px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.55);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }
    .slider__btn:hover{ background: rgba(11,18,32,.75); }
    .slider__btn.prev{ left: 10px; }
    .slider__btn.next{ right: 10px; }

    .dots{
      position:absolute;
      left:0; right:0; bottom:10px;
      display:flex;
      gap:8px;
      justify-content:center;
    }
    .dot{
      width:10px; height:10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition:.15s ease;
    }
    .dot.active{
      background: rgba(79,140,255,.75);
      border-color: rgba(79,140,255,.55);
      transform: scale(1.1);
    }

    /* Section */
    .section{
      margin-top: 18px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .section h2{ margin:0; font-size:18px; }
    .section .muted{ color:var(--muted); font-size:13px; }

    /* Product grid */
    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 14px;
    }
    @media (max-width: 1100px){ .grid{ grid-template-columns: repeat(4, 1fr); } }
    @media (max-width: 900px){ .grid{ grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 620px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 420px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(12,23,48,.45);
      overflow:hidden;
      box-shadow: 0 18px 45px rgba(0,0,0,.22);
      transition: .15s ease;
      display:flex;
      flex-direction:column;
      min-height: 320px;
      position: relative;
    }
    .card:hover{ transform: translateY(-2px); background: rgba(12,23,48,.60); }

    .img{
      height: 160px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(135deg, rgba(79,140,255,.22), rgba(255,255,255,.06));
      display:flex; align-items:center; justify-content:center;
      color: rgba(255,255,255,.75);
      font-weight:900;
      letter-spacing:.5px;
      position: relative;
    }
    .img img{ width:100%; height:100%; object-fit:cover; }

    /* Quick view overlay */
    .quick{
      position:absolute;
      inset: 10px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.55);
      backdrop-filter: blur(6px);
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transform: translateY(6px);
      transition: .15s ease;
      pointer-events:none;
      font-weight:900;
    }
    .card:hover .quick{
      opacity:1;
      transform: translateY(0);
    }

    .body{
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1;
    }
    .title{
      margin:0;
      font-size:14px;
      line-height:1.35;
    }
    .desc{
      margin:0;
      color:var(--muted);
      font-size:12.5px;
      line-height:1.5;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .meta{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .price{
      font-weight:900;
      letter-spacing:.2px;
    }
    .mini{
      display:inline-flex; align-items:center; gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      font-size:12px;
      font-weight:800;
      white-space:nowrap;
    }
    .mini--good{ color: #c7f9d5; border-color: rgba(34,197,94,.25); background: rgba(34,197,94,.10); }
    .mini--warn{ color: #fff2c7; border-color: rgba(251,191,36,.25); background: rgba(251,191,36,.10); }

    .empty{
      margin-top: 14px;
      border:1px solid var(--line);
      border-radius:18px;
      background: rgba(255,255,255,.03);
      padding: 34px 16px;
      text-align:center;
      color:var(--muted);
    }
    .empty h3{ margin:0; color:var(--text); }
    .empty p{ margin:10px auto 0 auto; max-width: 55ch; }

    /* Footer */
    .footer{
      margin: 34px 0 24px 0;
      color:var(--muted);
      font-size:13px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      border-top:1px solid var(--line);
      padding-top: 14px;
    }

    /* Scroll to top */
    .toTop{
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 46px;
      height: 46px;
      border-radius: 16px;
      border:1px solid var(--line);
      background: rgba(11,18,32,.65);
      backdrop-filter: blur(10px);
      color: var(--text);
      font-weight: 900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition:.15s ease;
      z-index: 80;
    }
    .toTop.show{
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }
      .add-btn{
    width:100%;
    margin-top:12px;
    padding:12px;
    border:none;
    border-radius:14px;
    font-weight:800;
    cursor:pointer;
    background:linear-gradient(135deg,#4f8cff,#3b82f6);
    color:white;
    transition:.2s ease;
}

.add-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(79,140,255,.4);
}

  </style>
</head>

<body>


  <!-- TOPBAR -->
  <header class="topbar">
    <div class="wrap">
      <div class="topbar__in">
        <a class="logo" href="{% url 'home' %}">
          <span class="logo__mark">OS</span>
          <span class="logo__text">
            Online Shop
            <small>Uzum/Yandex style</small>
          </span>
        </a>

        <form id="searchForm" class="search" method="get" action="{% url 'maxsulotlar' %}">
          <input id="searchInput" type="text" name="q" placeholder="Mahsulot qidiring: telefon, noutbuk..." value="{{ q|default:'' }}">
          <button id="searchBtn" class="btn btn--primary" type="submit">Qidirish</button>
          <div class="loadingbar"></div>
        </form>

        <div class="toplinks">
          {% if request.user.is_authenticated %}
            <a class="pill" href="{% url 'sevimlilar' %}">‚ù§Ô∏è <b>Sevimlilar</b></a>
            <a class="pill" href="{% url 'cart' %}">üõí <b>Savat</b></a>
            <a class="pill" href="{% url 'profil' %}">üë§ <b>Profil</b></a>
          {% else %}
            <a class="pill" href="{% url 'login' %}">üîë <b>Kirish</b></a>
            <a class="pill" href="{% url 'register' %}">üìù <b>Register</b></a>
          {% endif %}
        </div>
      </div>

      <!-- Categories -->
      <div class="cats">
        <div class="cats__row" id="catsRow">
          <div class="cat" data-q="telefon">üì± Telefonlar</div>
          <div class="cat" data-q="noutbuk">üíª Noutbuk</div>
          <div class="cat" data-q="quloqchin">üéß Quloqchin</div>
          <div class="cat" data-q="soat">‚åö Soat</div>
          <div class="cat" data-q="maishiy">üß∫ Maishiy</div>
          <div class="cat" data-q="kiyim">üëï Kiyim</div>
          <div class="cat" data-q="poyabzal">üëü Poyabzal</div>
          <div class="cat" data-q="aksessuar">üß© Aksessuar</div>
        </div>
      </div>
    </div>
  </header>

  <main class="wrap">

    <!-- SLIDER -->
    <section class="slider" id="slider">
      <div class="slides" id="slides">
        <div class="slide">
          <div>
            <span class="badge">‚ö° Tez yetkazish</span>
            <span class="badge">üí∏ Chegirmalar</span>
            <span class="badge">‚úÖ Ishonchli sotuvchilar</span>

            <h1>Bugun eng zo‚Äòr narxlar!</h1>
            <p>Mahsulotlarni qidiring, sevimlilarga qo‚Äòshing, savatga soling va buyurtma bering.</p>

            <div class="cta">
              <a class="btn btn--primary" href="{% url 'maxsulotlar' %}">Mahsulotlar</a>
              {% if request.user.is_authenticated %}
                <a class="btn" href="{% url 'sevimlilar' %}">Sevimlilar</a>
              {% else %}
                <a class="btn" href="{% url 'register' %}">Ro‚Äòyxatdan o‚Äòtish</a>
              {% endif %}
            </div>
          </div>

          <div class="box">
            <div class="row"><span>üî• Trend:</span> <b>Telefon / Noutbuk</b></div>
            <div class="row"><span>üõçÔ∏è Bugungi:</span> <b>Chegirmalar</b></div>
            <div class="row"><span>‚≠ê Reyting:</span> <b>Top sotuvchilar</b></div>
          </div>
        </div>

        <div class="slide">
          <div>
            <span class="badge">üöö 24 soat</span>
            <span class="badge">üõ°Ô∏è Kafolat</span>
            <span class="badge">üéÅ Bonuslar</span>

            <h1>Sevimlilar va savat juda qulay</h1>
            <p>Bir bosishda ‚ù§Ô∏è sevimlilar va üõí savatga qo‚Äòshish funksiyasi bilan ishlang.</p>

            <div class="cta">
              <a class="btn btn--primary" href="{% url 'maxsulotlar' %}?q=telefon">Telefonlar</a>
              <a class="btn" href="{% url 'maxsulotlar' %}?q=noutbuk">Noutbuklar</a>
            </div>
          </div>

          <div class="box">
            <div class="row"><span>‚úÖ To‚Äòlov:</span> <b>Xavfsiz</b></div>
            <div class="row"><span>üì¶ Yetkazish:</span> <b>Tez</b></div>
            <div class="row"><span>üí¨ Chat:</span> <b>Sotuvchiga yozish</b></div>
          </div>
        </div>

        <div class="slide">
          <div>
            <span class="badge">‚≠ê Top mahsulotlar</span>
            <span class="badge">üî• Hot sale</span>
            <span class="badge">üéØ Tavsiya</span>

            <h1>Uzum/Yandex market uslubida</h1>
            <p>Responsive dizayn, slider, kategoriya chiplar va grid kartalar ‚Äî hammasi tayyor.</p>

            <div class="cta">
              <a class="btn btn--primary" href="{% url 'maxsulotlar' %}">Hammasi ‚Üí</a>
            </div>
          </div>

          <div class="box">
            <div class="row"><span>üì± Mobile:</span> <b>OK</b></div>
            <div class="row"><span>üñ•Ô∏è Desktop:</span> <b>OK</b></div>
            <div class="row"><span>‚ö° Speed:</span> <b>Fast UI</b></div>
          </div>
        </div>
      </div>

      <div class="slider__btn prev" id="prevBtn">‚Äπ</div>
      <div class="slider__btn next" id="nextBtn">‚Ä∫</div>

      <div class="dots" id="dots"></div>
    </section>

    <!-- SECTION TITLE -->
    <div class="section">
      <div>
        <h2>Yangi mahsulotlar</h2>
        <div class="muted">Eng yangi qo‚Äòshilgan mahsulotlar</div>
      </div>
      <a class="btn" href="{% url 'maxsulotlar' %}">Hammasi ‚Üí</a>
    </div>

 <!-- PRODUCTS -->
{% if products %}
  {% with items=products %}
    <div class="grid">
      {% for p in items %}
        <div class="card">

          <a href="{% url 'mahsulot_detail' id=p.id %}">
            <div class="img">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="{{ p.title }}">
              {% else %}
                IMG
              {% endif %}
              <div class="quick">Tez ko‚Äòrish</div>
            </div>
          </a>

          <div class="body">
            <a href="{% url 'mahsulot_detail' id=p.id %}">
              <h3 class="title">{{ p.title }}</h3>
            </a>

            {% if p.desc %}
              <p class="desc">{{ p.desc }}</p>
            {% else %}
              <p class="desc">Tavsif mavjud emas.</p>
            {% endif %}

            <div class="meta">
              <div class="price">{{ p.price }} so‚Äòm</div>
              <span class="mini mini--warn">‚≠ê 4.8</span>
            </div>

            <!-- ‚úÖ SAVATGA QO‚ÄòSHISH -->
            {% if request.user.is_authenticated %}
              <form method="post" action="{% url 'add_to_cart' p.id %}" style="margin-top:12px;">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" class="add-btn">üõí Savatga qo‚Äòshish</button>
              </form>
            {% else %}
              <a href="{% url 'login' %}" class="add-btn" style="margin-top:12px; text-align:center; display:block;">
                Kirish kerak
              </a>
            {% endif %}

          </div>
        </div>
      {% endfor %}
    </div>
  {% endwith %}

{% elif maxsulotlar %}
  {% with items=maxsulotlar %}
    <div class="grid">
      {% for p in items %}
        <div class="card">

          <a href="{% url 'mahsulot_detail' id=p.id %}">
            <div class="img">
              {% if p.image %}
                <img src="{{ p.image.url }}" alt="{{ p.title }}">
              {% else %}
                IMG
              {% endif %}
              <div class="quick">Tez ko‚Äòrish</div>
            </div>
          </a>

          <div class="body">
            <a href="{% url 'mahsulot_detail' id=p.id %}">
              <h3 class="title">{{ p.title }}</h3>
            </a>

            {% if p.desc %}
              <p class="desc">{{ p.desc }}</p>
            {% else %}
              <p class="desc">Tavsif mavjud emas.</p>
            {% endif %}

            <div class="meta">
              <div class="price">{{ p.price }} so‚Äòm</div>
              <span class="mini mini--good">üöö tez</span>
            </div>


            <!-- ‚úÖ SAVATGA QO‚ÄòSHISH -->
            {% if request.user.is_authenticated %}
              <form method="post" action="{% url 'add_to_cart' p.id %}" style="margin-top:12px;">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" class="add-btn">üõí Savatga qo‚Äòshish</button>
              </form>
            {% else %}
              <a href="{% url 'login' %}" class="add-btn" style="margin-top:12px; text-align:center; display:block;">
                Kirish kerak
              </a>
            {% endif %}

          </div>
        </div>
      {% endfor %}
    </div>
  {% endwith %}

{% else %}
  <div class="empty">
    <h3>Hozircha mahsulot yo‚Äòq</h3>
    <p>Sotuvchi mahsulot qo‚Äòshgandan keyin bu yerda ko‚Äòrinadi.</p>
  </div>
{% endif %}


    <div class="footer">
      <span>¬© Online Shop</span>
      <span>Marketplace UI + JS Slider</span>
    </div>

  </main>

  <button class="toTop" id="toTop" title="Yuqoriga">‚Üë</button>

  <script>
    // ---------- Helpers ----------
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    // ---------- Search loading UX ----------
    const searchForm = $("#searchForm");
    const searchInput = $("#searchInput");
    const searchBtn = $("#searchBtn");

    if (searchForm) {
      searchForm.addEventListener("submit", () => {
        searchForm.classList.add("is-loading");
        searchBtn.setAttribute("disabled", "disabled");
        searchBtn.textContent = "Qidirilmoqda...";
      });
    }

    // ---------- Category chips -> fill search + go ----------
    $$(".cat").forEach(cat => {
      cat.addEventListener("click", () => {
        const q = cat.getAttribute("data-q") || "";
        if (searchInput) searchInput.value = q;
        if (searchForm) searchForm.requestSubmit();
      });
    });

    // ---------- Slider ----------
    const slides = $("#slides");
    const slider = $("#slider");
    const prevBtn = $("#prevBtn");
    const nextBtn = $("#nextBtn");
    const dotsWrap = $("#dots");

    let index = 0;
    let timer = null;

    function slideCount(){
      if (!slides) return 0;
      return slides.children.length;
    }

    function renderDots(){
      if (!dotsWrap) return;
      dotsWrap.innerHTML = "";
      const n = slideCount();
      for (let i=0; i<n; i++){
        const d = document.createElement("div");
        d.className = "dot" + (i===index ? " active" : "");
        d.addEventListener("click", () => {
          index = i;
          updateSlider();
          restartAuto();
        });
        dotsWrap.appendChild(d);
      }
    }

    function updateSlider(){
      if (!slides) return;
      const n = slideCount();
      if (n === 0) return;
      if (index < 0) index = n - 1;
      if (index >= n) index = 0;
      slides.style.transform = `translateX(-${index * 100}%)`;
      $$(".dot", dotsWrap).forEach((d, i) => d.classList.toggle("active", i===index));
    }

    function next(){
      index++;
      updateSlider();
    }
    function prev(){
      index--;
      updateSlider();
    }

    function startAuto(){
      stopAuto();
      timer = setInterval(next, 4000);
    }
    function stopAuto(){
      if (timer) clearInterval(timer);
      timer = null;
    }
    function restartAuto(){
      startAuto();
    }

    if (slider && slides && slideCount() > 1){
      renderDots();
      updateSlider();
      startAuto();

      if (nextBtn) nextBtn.addEventListener("click", () => { next(); restartAuto(); });
      if (prevBtn) prevBtn.addEventListener("click", () => { prev(); restartAuto(); });

      // pause on hover
      slider.addEventListener("mouseenter", stopAuto);
      slider.addEventListener("mouseleave", startAuto);

      // swipe on mobile
      let startX = 0;
      slider.addEventListener("touchstart", (e) => {
        startX = e.touches[0].clientX;
      }, {passive:true});

      slider.addEventListener("touchend", (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = endX - startX;
        if (Math.abs(diff) > 40){
          diff < 0 ? next() : prev();
          restartAuto();
        }
      }, {passive:true});
    }

    // ---------- Scroll to top ----------
    const toTop = $("#toTop");
    function onScroll(){
      if (!toTop) return;
      if (window.scrollY > 500) toTop.classList.add("show");
      else toTop.classList.remove("show");
    }
    window.addEventListener("scroll", onScroll, {passive:true});
    onScroll();

    if (toTop){
      toTop.addEventListener("click", () => {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    }
  </script>
</body>
</html>
